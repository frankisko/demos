{% extends "templates/layouts/base_fusion_tables.html" %}
{% block layout_title %}Fusion Tables: Filtros {% endblock %}
{% block layout_scripts_styles %}
	{{ super() }}
	<script type="text/javascript">
		var map;
    	var layer;
    	var api_key = "AIzaSyA1ilUeMX-Yc-XrWtTgw6Mu6KA8wKLsPuQ";
    	var table_id = "1ix8bNytTbjpkIswMcODFno2PIrgX5W6fM0YbSLM";
    
	    function get_names(){
	    	var query = "https://www.googleapis.com/fusiontables/v1/query?key=" + api_key + "&sql="
					  + "SELECT col0 "
					  + "FROM " + table_id;

			$.getJSON(query, function(data) {
				var html = "<option value=''>Seleccione...</option>";
				var estadio = "";			
	  			for(var i = 0; i < data.rows.length; i++) {  				
	  				estadio = data.rows[i][0];
					html += '<option value="' + estadio + '">' + estadio + '</option>';								
				}
				$("#estadio").html(html);
			});
    	}    
    
	    //actualizar mapa
		function actualizarMapa(layer) {
			var options = {
				select 	: 'col3',
				from	: table_id 
			};
			if ($("#estadio").val()) {
				options.where = "Estadio = '" + $("#estadio").val() + "'"
			}
			
			layer.setOptions({query: options});
		}
    
	    $(document).ready(function() {
			map = new google.maps.Map(document.getElementById('map_canvas'), {
		    	center: new google.maps.LatLng(20.704618289064125,-103.32845449447632),
		        zoom: 4,
		        mapTypeId: google.maps.MapTypeId.ROADMAP
			});
		          
		    get_names();      	
	      	
	      	layer = new google.maps.FusionTablesLayer({
		    	query: {
		          select: "*",
		          from: table_id	         
		        },
		        map: map
			});
			
			$("#estadio").change(function(){
				actualizarMapa(layer);
			});	
	    });
	</script>    
{% endblock %}
{% block layout_content %}
	<h2>Fusion Tables / Filtros</h2>
	<div class="container">
		<div class="tabbable">
		  	<ul id="myTab" class="nav nav-tabs">
		  		<li><a href="#demo" data-toggle="tab" id="demoTab">Demo</a></li>
		  		<li><a href="#descripcion" data-toggle="tab">Descripción</a></li>
			    <li><a href="#codigo" data-toggle="tab">Código</a></li>
		    </ul>
	  		<div class="tab-content" id="myTabContent">
	  			 <div id="descripcion" class="tab-pane">
	  			 	<h4>Para filtrar datos de una Fusion Table se necesita:</h4>
	  			 	<ul>
	  			 		<li>Modificar el parámetro where dentro de las opciones del Fusion Table Layer.</li>
	  			 	</ul>
				</div>
				<div id="demo" class="tab-pane">
		    		<div id="map_canvas"> </div>
		    		<p>
		    			Estadio: 
		    			<select id="estadio">    	
    					</select>
    				</p>	
		    		
		    		
		        </div>
		        <div id="codigo" class="tab-pane">
					<pre class="brush: js">
&lt;script src="https://maps.googleapis.com/maps/api/js?sensor=false"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
var map;
var layer;
var api_key = "AIzaSyA1ilUeMX-Yc-XrWtTgw6Mu6KA8wKLsPuQ";
var table_id = "1ix8bNytTbjpkIswMcODFno2PIrgX5W6fM0YbSLM";

function get_names(){
    var query = "https://www.googleapis.com/fusiontables/v1/query?key=" + api_key + "&sql="
              + "SELECT col0 "
              + "FROM " + table_id;

    $.getJSON(query, function(data) {
        var html = "&lt;option value=''&gt;Seleccione...&lt;/option&gt;";
        var estadio = "";           
        for(var i = 0; i &lt; data.rows.length; i++) {                 
            estadio = data.rows[i][0];
            html += '&lt;option value="' + estadio + '"&gt;' + estadio + '&lt;/option&gt;';                             
        }
        $("#estadio").html(html);
    });
}    

//actualizar mapa
function actualizarMapa(layer) {
    var options = {
        select  : 'col3',
        from    : table_id 
    };
    if ($("#estadio").val()) {
        options.where = "Estadio = '" + $("#estadio").val() + "'"
    }
    
    layer.setOptions({query: options});
}

function initialize() {
    map = new google.maps.Map(document.getElementById('map-canvas'), {
        center: new google.maps.LatLng(20.704618289064125,-103.32845449447632),
        zoom: 4,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    });
          
    get_names();        
    
    layer = new google.maps.FusionTablesLayer({
        query: {
          select: "*",
          from: table_id             
        },
        map: map
    });
    
    var estadio = document.getElementById("estadio");   
    google.maps.event.addDomListener(estadio, 'change', function() {
         actualizarMapa(layer);                
    });     
}
google.maps.event.addDomListener(window, 'load', initialize);   
&lt;/script&gt;
					</pre>
				</div>
			</div>
		</div>
	</div>    		
{% endblock %}